<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Getting Started by LiveTex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Getting Started</h1>
      <h2 class="project-tagline"></h2>
    </section>

    <a href="widgets-api/index.html"></a>

    <section class="main-content">
      <h1>
<a id="livetex-sdk-Стартовая-документация" class="anchor" href="#livetex-sdk-%D0%A1%D1%82%D0%B0%D1%80%D1%82%D0%BE%D0%B2%D0%B0%D1%8F-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>LiveTex SDK. Стартовая документация</h1>

<p><strong>Livetex SDK</strong> предоставляет инструментарий для реализации возможность 
консультировать пользователей мобильных приложений. </p>

<p>Функциональность:</p>

<ul>
<li>возможность выбора департамента и оператора для диалога;</li>
<li>создание и завершение диалога;</li>
<li>передача и прием текстовых сообщений;</li>
<li>передача и прием файлов;</li>
<li>мгновенное оповещение о событиях: оповещение о наборе, 
удерживающие сообщения, изменение оператора диалога,
закрытие диалога оператором;</li>
<li>просмотр истории сообщений;</li>
</ul>

<p>Документация API: </p>

<ul>
<li>
<a href="http://livetex.github.io/sdk/java/index.html">Android</a> </li>
<li><a href="http://livetex.github.io/sdk/ios/index.html">iOS</a></li>
<li><a href="http://livetex.github.io/sdk/wp/index.html">Windows Phone</a></li>
</ul>

<p>Demo-приложение: </p>

<ul>
<li>
<a href="https://github.com/LiveTex/Livetex-Android-SDK-Demo">Android</a> </li>
<li><a href="https://github.com/LiveTex/Livetex-iOS-SDK-Demo">iOS</a></li>
<li><a href="https://github.com/LiveTex/Livetex-Windows-Phone-SDK-Demo">Windows Phone</a></li>
</ul>

<p>Установка Demo-приложения: </p>
<a href="https://play.google.com/store/apps/details?id=nit.livetex.livetexsdktestapp">
    <img alt="Get it on Google Play" src="https://developer.android.com/images/brand/ru_generic_rgb_wo_45.png" />
</a>


<h2>
<a id="С-чего-начать" class="anchor" href="#%D0%A1-%D1%87%D0%B5%D0%B3%D0%BE-%D0%BD%D0%B0%D1%87%D0%B0%D1%82%D1%8C" aria-hidden="true"><span class="octicon octicon-link"></span></a>С чего начать?</h2>

<h3>
<a id="Шаг-1-Создание-аккаунта" class="anchor" href="#%D0%A8%D0%B0%D0%B3-1-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B0%D0%BA%D0%BA%D0%B0%D1%83%D0%BD%D1%82%D0%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 1. Создание аккаунта</h3>

<p>Регистрируемся в системе <a href="https://my.livetex.ru/register/">Livetex</a>, 
добавляем <a href="https://my.livetex.ru/settings/personnel/add/">оператора</a> и 
<a href="https://my.livetex.ru/settings/sites/">сайт</a>.</p>

<h3>
<a id="Шаг-2-Получение-ключа-разработчика" class="anchor" href="#%D0%A8%D0%B0%D0%B3-2-%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BB%D1%8E%D1%87%D0%B0-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 2. Получение ключа разработчика.</h3>

<p><a href="mailto:sdk.customers@livetex.ru">Запрашиваем</a> ключ разработчика. В письме необходимо указать идентификатор
аккаунта в системе Livetex. Идентификатор аккаунта в системе можно посмотреть в личном кабинете в выпадающем списке при нажатии на профиль администратора (верхний правый угол).</p>

<h3>
<a id="Шаг-3-Добавление-библиотеки-sdk-к-проекту" class="anchor" href="#%D0%A8%D0%B0%D0%B3-3-%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B8-sdk-%D0%BA-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D1%83" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 3. Добавление библиотеки SDK к проекту</h3>

<p>Пример добавления библиотеки SDK к проекту можно найти в репозитории с 
 demo-приложением.</p>
-<p>Бинарные пакеты библиотек доступны в публичных репозиториях.<br>
+<p>Бинарные пакеты библиотек доступны в публичных репозиториях.<p>
 Для Android. 
 <ul>
-<li> В замыкании repositories добавить:
+<li> В замыкании <code>repositories</code> добавить:<br>
 <code> 
-repositories {
-jcenter()
-maven {
-url "http://sonatype-nexus.livetex.ru/nexus/content/repositories/livetex-public-artifacts"
-      }
-              }
+repositories {<br>
+jcenter()<br>
+maven {<br>
+url "http://sonatype-nexus.livetex.ru/nexus/content/repositories/livetex-public-artifacts"<br>
+      }<br>
+              }<br>
 </code></li>
-<li>В dependencies добавить compile 'ru.livetex.sdk:app_sdk2-release:1.0.0'</li></ul><br>
-Для Windows phone. Ссылка на пакет для windows phone https://www.nuget.org/packages/LiveTex.SDK/
-<p>
+<li>В <code>dependencies</code> добавить <code>compile 'ru.livetex.sdk:app_sdk2-release:1.0.0'</code></li></ul><br>
+Для Windows phone. </p>
+<p>Ссылка на пакет для windows phone: <a href="https://www.nuget.org/packages/LiveTex.SDK/">https://www.nuget.org/packages/LiveTex.SDK/</a>
+
 <h3>
<a id="Шаг-4-Разработка-обработчиков-оповещений-от-сервера" class="anchor" href="#%D0%A8%D0%B0%D0%B3-4-%D0%A0%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0-%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%BE%D0%B2-%D0%BE%D0%BF%D0%BE%D0%B2%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B9-%D0%BE%D1%82-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 4. Разработка обработчиков оповещений от сервера</h3>

<p>Livetex SDK предоставляет возможность мгновенного оповещения о новых 
событиях от сервера. Новые события могут влиять на отображение информации 
пользователю приложения. Livetex SDK требует от разработчика реализации 
обработчика оповещений от сервера. Детали интерфейса обработчика можно найти 
по ссылкам:</p>

<ul>
<li>INotificationDialogHandler <a href="http://livetex.github.io/sdk/java/sdk/handler/INotificationDialogHandler.html">Android</a>
</li>
<li>LTMobileSDKNotificationHandlerProtocol <a href="http://livetex.github.io/sdk/ios/Protocols/LTMbileSDKNotificationHandlerProtocol/index.html#//apple_ref/occ/intf/LTMbileSDKNotificationHandlerProtocol">iOS</a>
</li>
<li>ILiveTexEventsHandler <a href="http://livetex.github.io/sdk/wp/html/d98a0cef-10e3-68b7-287e-caa3d840e640.htm">Windows Phone</a>
</li>
</ul>

<p>Пример обработчика оповещений на Java с функциональностью открытия диалога и отсылки сообщения.</p>

<div class="highlight highlight-java"><pre>
<span class="pl-c">// Обработчик инициализации.</span>
<span class="pl-k">class</span> <span class="pl-en">CustomInitHandler</span> <span class="pl-k">implements</span> <span class="pl-e">IInitHandler</span> {

  <span class="pl-k">private</span> <span class="pl-smi">Livetex</span> sdk;

  <span class="pl-en">CustomInitHandler</span>(<span class="pl-smi">Livetex</span> <span class="pl-v">livetex</span>) {
    sdk <span class="pl-k">=</span> livetex;
  }

  <span class="pl-c">// В случае успешной инициализации сохраняем переданный токен и создаем обращение.</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">onSuccess</span>(<span class="pl-smi">String</span> <span class="pl-v">token</span>) {
    saveTokenToCustomClientStorage(token);
    sdk<span class="pl-k">.</span>request(<span class="pl-k">new</span> <span class="pl-k">AHandler&lt;<span class="pl-smi">State</span>&gt;</span>());
  }
}

<span class="pl-k">class</span> <span class="pl-en">CustomNotificationHandler</span> <span class="pl-k">implements</span> <span class="pl-e">INotificationHandler</span> {

  <span class="pl-k">private</span> <span class="pl-smi">Livetex</span> sdk;

  <span class="pl-en">CustomNotificationHandler</span>(<span class="pl-smi">Livetex</span> <span class="pl-v">livetex</span>) {
    sdk <span class="pl-k">=</span> livetex;
  }

  <span class="pl-c1">...</span>

  <span class="pl-c">// При назначении оператора для диалога отправляем приветственное сообщение.</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">updateDialogState</span>(<span class="pl-smi">DialogState</span> <span class="pl-v">state</span>) {
    <span class="pl-k">if</span> (state<span class="pl-k">.</span>isSetEmployee()) {
      sdk<span class="pl-k">.</span>sendTextMessage(<span class="pl-s"><span class="pl-pds">"</span>Hello<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-k">AHandler&lt;<span class="pl-smi">TextMessage</span>&gt;</span>());
    }
  }

  <span class="pl-c">// Логируем сообщения оператора.</span>
  <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">receiveTextMessage</span>(<span class="pl-smi">TextMessage</span> <span class="pl-v">message</span>) {
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(message<span class="pl-k">.</span>getText());
  }
  <span class="pl-c1">...</span>
}
</pre></div>

<p>Пример обработчика оповещений на Objective-C с функциональностью открытия диалога и отсылки сообщения.</p>

<div class="highlight highlight-objective-c"><pre>
<span class="pl-k">@interface</span> <span class="pl-en">LTCustomNotificationDelegate</span> : <span class="pl-e">NSObject</span>  &lt;LTMobileSDKNotificationHandlerProtocol&gt;
<span class="pl-k">@property</span>(<span class="pl-k">nonatomic</span>, <span class="pl-k">copy</span>) <span class="pl-k">void</span> (^callBack) (<span class="pl-k">id</span> data);
<span class="pl-k">@end</span>

...

<span class="pl-k">@implementation</span> <span class="pl-en">LTCustomNotificationDelegate</span>

<span class="pl-c">// Обработка изменения состояния.</span>
- (<span class="pl-k">void</span>) <span class="pl-en">updateDialogState</span><span class="pl-en">:</span> (LTDialogState *) <span class="pl-smi">state</span>
{
    <span class="pl-c">// Проверяем назначен ли оператор для диалога.</span>
    <span class="pl-k">if</span> (state.<span class="pl-smi">employee</span> != <span class="pl-c1">nil</span>) {
      <span class="pl-c">// Отправляем сообщение.</span>
      [sdk <span class="pl-c1">sendMessage:</span><span class="pl-s"><span class="pl-pds">@"</span>Hello<span class="pl-pds">"</span></span> <span class="pl-c1">success:</span>^(LTTextMessage *message) {
        ...
      } <span class="pl-c1">failure:</span>^(<span class="pl-c1">NSException</span> *chatExeption) {
        ...
      }];
    }
}

<span class="pl-c">// Обработка нового сообщения от оператора.</span>
- (<span class="pl-k">void</span>) <span class="pl-en">receiveTextMessage</span><span class="pl-en">:</span> (LTTextMessage *) <span class="pl-smi">message</span>
{
    <span class="pl-c1">NSLog</span>(message.<span class="pl-smi">text</span>);
}
<span class="pl-k">@end</span>
</pre></div>

<p>Пример обработчика оповещений на C# с функциональностью открытия диалога и отсылки сообщения.</p>

<div class="highlight highlight-csharp"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">CustomNotificationHandler</span>: <span class="pl-k">ILiveTexEventsHandler</span> {

    <span class="pl-k">private</span> LiveTexClient client;

    <span class="pl-k">public</span> <span class="pl-en">CustomNotificationHandler</span>(<span class="pl-k">LiveTexClient</span> <span class="pl-smi">client</span>) {
        client = client;
    }

    ...

    <span class="pl-k">public</span> <span class="pl-en">ILiveTexEventsHandler.UpdateDialogState</span>(<span class="pl-k">DialogState</span> <span class="pl-smi">dialogState</span>) {
        <span class="pl-k">if</span> (dialogState.Employee != <span class="pl-c1">null</span>) {
            Task&lt;TextMessage&gt; messageTask = SendTextMessageAsync(<span class="pl-s"><span class="pl-pds">"</span>Hello, Employee!<span class="pl-pds">"</span></span>);
            TextMessage message = <span class="pl-k">await</span> messageTask;
        }
    }

    <span class="pl-k">public</span> <span class="pl-en">ILiveTexEventsHandler.ReceiveTextMessage</span>(<span class="pl-k">TextMessage</span> <span class="pl-smi">message</span>) {
        Console.Write(message.Text);
    }

    ...
}</pre></div>

<h3>
<a id="Шаг-5-Инициализация-sdk" class="anchor" href="#%D0%A8%D0%B0%D0%B3-5-%D0%98%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-sdk" aria-hidden="true"><span class="octicon octicon-link"></span></a>Шаг 5. Инициализация SDK</h3>

<p>Пример инициализации Android SDK в основном потоке приложения.</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// URL сервиса аутентификации, получен на втором шаге данного гайда.</span>
string url <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>http://authentication-service-sdk-production-1.livetex.ru<span class="pl-pds">"</span></span>;

<span class="pl-c">// Ключ SDK для аутентификации кодовой базы клиент, получен на втором шаге данного гайда.</span>
string key <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>NEVER_SHOW_THIS_KEY_TO_STRANGERS<span class="pl-pds">"</span></span>;

<span class="pl-c">// Идентификатор приложения клиента - это идентификатор сайта, который можно </span>
<span class="pl-c">// получить в личном кабинете.</span>
string application <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>10001350<span class="pl-pds">"</span></span>;

<span class="pl-c">// Список возможностей реализованных в клиентском приложении.</span>
<span class="pl-k">List&lt;<span class="pl-smi">Capabilities</span>&gt;</span> capabilities <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">ArrayList&lt;<span class="pl-smi">Capabilities</span>&gt;</span>();

<span class="pl-c">// Клиентское приложение умеет вести диалог.</span>
capabilities<span class="pl-k">.</span>add(<span class="pl-smi">Capabilities</span><span class="pl-c1"><span class="pl-k">.</span>CHAT</span>);

<span class="pl-c">// Клиентское приложение умеет принимать файлы.</span>
capabilities<span class="pl-k">.</span>add(<span class="pl-smi">Capabilities</span><span class="pl-c1"><span class="pl-k">.</span>FILES_RECEIVE</span>);

<span class="pl-c">// Получение токена аутентификации из персистентного хранилища клиента SDK.</span>
<span class="pl-c">// Реализуется на усмотрение разработчика. На этапе инициализации SDK можно</span>
<span class="pl-c">// указать уникальный токен для идентификации клиента и восстановления </span>
<span class="pl-c">// истории переписки. Если токен указан не будет система создаст нового </span>
<span class="pl-c">// клиента.    </span>
<span class="pl-smi">String</span> token <span class="pl-k">=</span> getTokenFromCustomClientStorage();

<span class="pl-smi">Builder</span> builder <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Builder</span>(context, key, application);
builder<span class="pl-k">.</span>addCapabilities(capabilities);
builder<span class="pl-k">.</span>addToken(token);
builder<span class="pl-k">.</span>addUrl(url);

<span class="pl-smi">Livetex</span> livetex <span class="pl-k">=</span> <span class="pl-k">new</span> builder.build();

<span class="pl-c">// Обработчик инициализации SDK реализуется разработчиком.</span>
<span class="pl-smi">CustomInitHandler</span> initHandler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">CustomInitHandler</span>(livetex);
<span class="pl-c">// Обработчик оповещений от сервера реализуется разработчиком.</span>
<span class="pl-smi">CustomNotificationHandler</span> notificationHandler <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">CustomNotificationHandler</span>(livetex);

livetex<span class="pl-k">.</span>init(initHandler, notificationHandler);</pre></div>

<p>Пример инициализации iOS SDK в основном потоке приложения.</p>

<div class="highlight highlight-objective-c"><pre>LTMobileSDKInitializationParams *params = [LTMobileSDKInitializationParams <span class="pl-c1">new</span>];

<span class="pl-c">// URL сервиса аутентификации, получен на втором шаге данного гайда.</span>
params.livetexUrl = <span class="pl-s"><span class="pl-pds">@"</span>http://authentication-service-sdk-production-1.livetex.ru<span class="pl-pds">"</span></span>;

<span class="pl-c">// Ключ SDK для аутентификации кодовой базы клиент, получен на втором шаге данного гайда.</span>
params.sdkKey = <span class="pl-s"><span class="pl-pds">@"</span>NEVER_SHOW_THIS_KEY_TO_STRANGERS<span class="pl-pds">"</span></span>;


<span class="pl-c">// Идентификатор приложения клиента - это идентификатор сайта, который можно </span>
<span class="pl-c">// получить в личном кабинете.</span>
params.applicationId = <span class="pl-s"><span class="pl-pds">@"</span>10001350<span class="pl-pds">"</span></span>;

LTMobileSDK *sdk = [[LTMobileSDK <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithParams:</span>params];

<span class="pl-c">// Инициализация кастомного обработчика оповещений.</span>
LTCustomNotificationDelegate *delegate = [LTCustomNotificationDelegate <span class="pl-c1">new</span>];
sdk.delegate = delegate;

<span class="pl-c">// Инициализация SDK.</span>
[sdk <span class="pl-c1">runWithSuccess:</span>^(<span class="pl-c1">NSString</span> *token) {

    <span class="pl-c">// Запрос диалога с любым оператором.</span>
    [sdk <span class="pl-c1">requestWithSuccess:</span>^(LTDialogState *state) {
        <span class="pl-c">//...</span>
    } <span class="pl-c1">failure:</span>^(<span class="pl-c1">NSException</span> *chatExeption) {
        <span class="pl-c">//...</span>
    }];

} <span class="pl-c1">failure:</span>^(<span class="pl-c1">NSException</span> *exception) {
    <span class="pl-c">// ...</span>
}];</pre></div>

<p>Пример инициализации Windows Phone SDK в основном потоке приложения.</p>

<div class="highlight highlight-csharp"><pre><span class="pl-c">// Ключ разработчика Livetex SDK.</span>
<span class="pl-k">string</span> key = <span class="pl-s"><span class="pl-pds">"</span>NEVER_SHOW_THIS_KEY_TO_STRANGERS<span class="pl-pds">"</span></span>;

<span class="pl-c">// Идентификатор приложения.</span>
<span class="pl-k">string</span> applicationID = <span class="pl-s"><span class="pl-pds">"</span>10001350<span class="pl-pds">"</span></span>;

<span class="pl-c">// URL сервиса аутентификации.</span>
<span class="pl-k">string</span> authServerUri = <span class="pl-s"><span class="pl-pds">"</span>http://authentication-service-sdk-production-1.livetex.ru<span class="pl-pds">"</span></span>


<span class="pl-k">var</span> factory = <span class="pl-k">new</span> LiveTexClientFactory(key, applicationID, <span class="pl-k">new</span> Uri(authServerUri));
LiveTexClient livetexClient = <span class="pl-k">await</span> factory.CreateAsync(Token, Capabilities.Chat, Capabilities.FilesReceive);
CustomNotificationHandler handler = CustomNotificationHandler(livetexClient);

Token = liveTexClient.GetToken();

livetexClient.SubscribeToEvents(handler);

Task&lt;DialogState&gt; request = client.RequestDialogAsync();
DialogState state = <span class="pl-k">await</span> request;
</pre></div>

<p>Описанный выше пример позволяет реализовать следующий сценарий:</p>

<ol>
<li>Пользователь инициализирует SDK (вызов <code>init</code>).</li>
<li>При успешной инициализации SDK выполняется соответствующий обработчик (вызов <code>onSuccess</code>).</li>
<li>Тело обработчика успешной инициализации запрашивает диалог с оператором (вызов <code>request</code>).</li>
<li>Обработчик оповещений дожидается события назначения оператора для диалога (вызов <code>updateDialogState</code>).</li>
<li>Если оператор для диалога назначен отправляем сообщение (вызов <code>sendTextMessage</code>).</li>
<li>Сообщения принимаемые от оператора логируются (вызов <code>receiveTextMessage</code>). </li>
</ol>

<h2>
<a id="Замечания" class="anchor" href="#%D0%97%D0%B0%D0%BC%D0%B5%D1%87%D0%B0%D0%BD%D0%B8%D1%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>Замечания.</h2>

<p>LiveTex SDK предоставляет функциональность оценки чата и создания жалобы на диалог. Для полноценной работы данных опций необходимо, чтобы они были подключены в соответствующих разделах личного кабинета. </p>

      <footer class="site-footer">

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

